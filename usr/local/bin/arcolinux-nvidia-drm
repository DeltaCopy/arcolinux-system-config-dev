#!/bin/bash

echo
echo "################################################################"
echo "################### Adding option nvidia-drm.modeset=1"
echo "################################################################"
echo

# SYSTEMD-BOOT
if [ -d /boot/efi/loader/entries/ ]; then
	ENTRY_DIR="/boot/efi/loader/entries/"
	PARAM="nvidia-drm.modeset=1"

	for entry in "$ENTRY_DIR"*.conf; do
  	if sudo grep -q "nvidia-drm.modeset=1" "$entry"; then
    	echo "Parameter already present in $(basename "$entry")"
  	else
    	sudo sed -i "/^options / s/options /&$PARAM /" "$entry"
    	echo "Added parameter to $(basename "$entry")"
  	fi
	done
fi

echo
echo
echo "##################################################"
echo "End fix"
echo "##################################################"
echo



