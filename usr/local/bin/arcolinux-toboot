#!/bin/bash
#set -e
##################################################################################################################
# Author    : Erik Dubois
# Website   : https://www.erikdubois.be
# Website   : https://www.alci.online
# Website   : https://www.arcolinux.info
# Website   : https://www.arcolinux.com
# Website   : https://www.arcolinuxd.com
# Website   : https://www.arcolinuxb.com
# Website   : https://www.arcolinuxiso.com
# Website   : https://www.arcolinuxforum.com
##################################################################################################################
#
#   DO NOT JUST RUN THIS. EXAMINE AND JUDGE. RUN AT YOUR OWN RISK.
#
##################################################################################################################
#tput setaf 0 = black 
#tput setaf 1 = red 
#tput setaf 2 = green
#tput setaf 3 = yellow 
#tput setaf 4 = dark blue 
#tput setaf 5 = purple
#tput setaf 6 = cyan 
#tput setaf 7 = gray 
#tput setaf 8 = light blue
##################################################################################################################

if lsblk | grep -q "/boot/efi" ; then

	echo "###############################################################################"
	echo "Removing other bootloaders"
	echo "###############################################################################"
	
	is_package_installed() {
	    if pacman -Q "$1" &> /dev/null; then
	        echo "Package $1 is installed."
	        return 0  # Success
	    else
	        echo "Package $1 is not installed."
	        return 1  # Failure
	    fi
	}

	#GRUB GONE
	if is_package_installed grub; then
	    echo "Removing grub..."
	    sudo pacman -R grub --noconfirm
	else
	    echo "Grub is not installed, no need to remove."
	fi

	if is_package_installed arcolinux-bootloader-grub-git; then
	    echo "Removing arcolinux-bootloader-grub-git..."
	    sudo pacman -R arcolinux-bootloader-grub-git --noconfirm
	else
	    echo "Arcolinux-bootloader-grub-git is not installed, no need to remove."
	fi

	if is_package_installed arcolinux-grub-theme-vimix-git; then
	    echo "Removing arcolinux-grub-theme-vimix-git..."
	    sudo pacman -R arcolinux-grub-theme-vimix-git --noconfirm
	else
	    echo "Arcolinux-grub-theme-vimix-git is not installed, no need to remove."
	fi

	#REFIND GONE
	if is_package_installed refind; then
	    echo "Removing refind..."
	    sudo pacman -R refind --noconfirm
	else
	    echo "Refind is not installed, no need to remove."
	fi

	if is_package_installed arcolinux-bootloader-refind-git; then
	    echo "Removing arcolinux-bootloader-refind-git..."
	    sudo pacman -R arcolinux-bootloader-refind-git --noconfirm
	else
	    echo "Arcolinux-bootloader-refind-git is not installed, no need to remove."
	fi

	if is_package_installed arcolinux-refind-theme-arco-git; then
	    echo "Removing arcolinux-refind-theme-arco-git..."
	    sudo pacman -R arcolinux-refind-theme-arco-git --noconfirm
	else
	    echo "Arcolinux-refind-theme-arco-git is not installed, no need to remove."
	fi

	echo "###############################################################################"
	echo "Installing the default systemd-boot from ArcoLinux"
	echo "###############################################################################"

	sudo pacman -S --noconfirm kernel-install-mkinitcpio

	sudo bootctl install
	sudo reinstall-kernels

	if [[ -f /boot/efi/loader/loader.conf ]];then
		sudo sed -i "s/#timeout 3/timeout 3/g" /boot/efi/loader/loader.conf
	fi

	if [[ -f /boot/efi/loader/loader.conf ]];then
		sudo sed -i "s/#console-mode keep/console-mode keep/g" /boot/efi/loader/loader.conf
	fi

	echo
	echo "###############################################################################"
	echo "###                DONE - YOU CAN CLOSE THIS WINDOW                        ####"
	echo "###############################################################################"

else

	echo
	echo "###############################################################################"
	echo "###                YOU CAN NOT USE SYSTEMD-BOOT                         ####"
	echo "###                        KEEP USING GRUB                                 ####"
	echo "###        https://wiki.archlinux.org/title/Arch_boot_process              ####"
	echo "###############################################################################"
fi
